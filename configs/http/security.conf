# Security Headers
# -----------------------------------------------------------------------------
# Protection against common web vulnerabilities
add_header X-Frame-Options "DENY" always;            # Prevent clickjacking
add_header X-Content-Type-Options "nosniff" always;  # Prevent MIME-sniffing
add_header X-XSS-Protection "1; mode=block" always;  # XSS protection
add_header Referrer-Policy "strict-origin-when-cross-origin" always;  # Referrer control

# Basic Security Settings
server_tokens off;              # Hide nginx version

# Request Tracking
# -----------------------------------------------------------------------------
# Generate unique request IDs for tracing
map $remote_addr$request_id$time_iso8601 $request_id_final {
    default $request_id;
    "" $remote_addr$time_iso8601;  # Fallback if no request_id
}

# Logging Configuration
# -----------------------------------------------------------------------------
# Load logging configuration files
include /usr/local/openresty/nginx/modules/config/time_maps.conf;
include /usr/local/openresty/nginx/modules/config/log_formats.conf;
include /usr/local/openresty/nginx/modules/config/log_control.conf;

# Log file configuration
access_log /var/log/nginx/access.log main_ext buffer=4k flush=1s;
access_log /var/log/nginx/security.log security if=$log_security buffer=4k flush=1s;
error_log /var/log/nginx/error.log debug; 