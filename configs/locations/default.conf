# Default Handler
# ---------------------------------------------------------------------
location / {
    try_files $uri @default_handler;
}

location @default_handler {
    content_by_lua_block {
        local middleware = require "middleware"
        local ctx = middleware.new_context()

        -- Apply default handling middleware
        middleware.run(ctx, "default_tracking")

        -- Handle default response
        local response = require "handlers.default"
        response.handle_not_found(ctx)
    }
}

# Hidden Files Protection
# ---------------------------------------------------------------------
location ~ /\. {
    access_by_lua_block {
        local middleware = require "middleware"
        local ctx = middleware.new_context()

        -- Apply security middleware
        middleware.run(ctx, "security_tracking")

        -- Return 403
        return ngx.exit(403)
    }
} 